<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Builder+Exporter (M1)</title>
  <style>
    body { font: 12px/1.4 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial; margin: 12px; }
    textarea { width: 100%; height: 320px; font-family: ui-monospace,Consolas,Menlo,monospace; }
    .row { display:flex; gap:8px; margin:8px 0; }
    button { padding:6px 10px; cursor:pointer; }
    #log { background:#0f172a; color:#e2e8f0; padding:8px; height:180px; overflow:auto; }
  </style>
</head>
<body>
  <h3>Figma Builder+Exporter (M1)</h3>
  <p>–í—Å—Ç–∞–≤—å—Ç–µ <b>TaskSpec (JSON)</b> –Ω–∏–∂–µ –∏ –Ω–∞–∂–º–∏—Ç–µ <b>Validate</b>.</p>
  <textarea id="spec"></textarea>
  <div class="row">
    <button id="btn-validate">Validate</button>
    <button id="btn-build">Build</button>
    <button id="btn-export">Export</button>
    <button id="btn-close" style="margin-left:auto;">Close</button>
  </div>
  <pre id="log"></pre>

  <script>
    const log = (m) => {
      const el = document.getElementById('log');
      el.textContent += (typeof m === 'string' ? m : JSON.stringify(m, null, 2)) + "\\n";
      el.scrollTop = el.scrollHeight;
    };

    // –ü—Ä–∏–º–µ—Ä ‚Äî –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–∏–º textarea –≤–∞–ª–∏–¥–Ω—ã–º TaskSpec (–º–æ–∂–Ω–æ –ø—Ä–∞–≤–∏—Ç—å)
    const sample = {
      "meta": { "specVersion": "0.1", "id": "landing-v1" },
      "target": { "fileId": "REPLACE_WITH_FILE_ID", "pageName": "Landing", "frameName": "Home", "frameSize": { "w": 1440, "h": 1024 } },
      "grid": { "container": 1200, "columns": 12, "gap": 24, "margins": 24 },
      "tokens": { "fontFamily": "Inter", "colors": { "primary": "#6C5CE7", "text": "#111827" } },
      "sections": [
        { "type": "hero", "name": "Hero", "padding": [64,24], "spacing": 24, "layout": "stack", "content": { "title": "–ó–∞–≥–æ–ª–æ–≤–æ–∫", "subtitle": "–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫", "cta": "–ö—É–ø–∏—Ç—å" } },
        { "type": "features", "name": "–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞", "layout": "grid-3", "spacing": 32, "content": { "items": [ { "title": "–ë—ã—Å—Ç—Ä–æ" }, { "title": "–î—ë—à–µ–≤–æ" }, { "title": "–¢–æ—á–Ω–æ" } ] } },
        { "type": "cta", "name": "–ü—Ä–∏–∑—ã–≤", "padding": [48,24], "content": { "text": "–ù–∞—á–∞—Ç—å —Å–µ–π—á–∞—Å", "button": "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å" } },
        { "type": "footer", "name": "–ü–æ–¥–≤–∞–ª", "padding": [48,24] }
      ],
      "acceptance": { "maxSpacingDeviation": 2, "checkAutoLayout": true }
    };
    document.getElementById('spec').value = JSON.stringify(sample, null, 2);

    const post = (type) => {
      const val = document.getElementById('spec').value;
      parent.postMessage({ pluginMessage: { type, taskSpec: val } }, '*');
    };

    document.getElementById('btn-validate').onclick = () => post('validate');
    document.getElementById('btn-build').onclick = () => post('build');
    document.getElementById('btn-export').onclick = () => post('export');
    document.getElementById('btn-close').onclick = () => post('close');

    onmessage = (e) => {
      const msg = e.data.pluginMessage;
      if (!msg) return;
      if (msg.type === 'validate:ok') log('‚úÖ Validate OK');
      else if (msg.type === 'validate:error') log('‚ùå ' + msg.error);
      else if (msg.type === 'build:todo') log('‚ÑπÔ∏è ' + msg.note);
      else if (msg.type === 'export:ok') log(msg.exportSpec);
      else if (msg.type === 'error') log('Ì≤• ' + msg.error);
      else log(msg);
    };
  </script>
</body>
</html>
